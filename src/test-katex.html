<!DOCTYPE html>
<html>
<head>
    <title>KaTeX Test</title>
    <style>
        body {
            background: #1a1a1a;
            color: #e5e5e7;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>KaTeX Loading Test</h1>
    
    <div class="test-section">
        <h2>Loading Status</h2>
        <p id="loading-status">Checking KaTeX loading...</p>
    </div>
    
    <div class="test-section">
        <h2>Math Rendering Test</h2>
        <p>Inline math: <span id="inline-test">$E = mc^2$</span></p>
        <p>Display math:</p>
        <div id="display-test">$$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$</div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <p>Check the browser console (F12) for detailed loading information.</p>
    </div>

    <script>
        console.log('Starting KaTeX test...');
        
        // Test different loading paths
        const paths = [
            './node_modules/katex/dist/katex.min.css',
            '../node_modules/katex/dist/katex.min.css',
            'node_modules/katex/dist/katex.min.css',
            'https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css'
        ];
        
        function testPath(path, callback) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = path;
            link.onload = () => {
                console.log('✅ CSS loaded from:', path);
                callback(true);
            };
            link.onerror = () => {
                console.log('❌ CSS failed from:', path);
                callback(false);
            };
            document.head.appendChild(link);
        }
        
        function loadKaTeXJS(cssPath) {
            const jsPath = cssPath.replace('.css', '.js');
            const script = document.createElement('script');
            script.src = jsPath;
            script.onload = () => {
                console.log('✅ KaTeX JS loaded from:', jsPath);
                console.log('KaTeX available:', typeof katex !== 'undefined');
                document.getElementById('loading-status').innerHTML = 
                    `<span style="color: #4fc3f7;">✅ KaTeX loaded successfully!</span><br>
                     Path: ${jsPath}<br>
                     Version: ${katex ? katex.version || 'Unknown' : 'N/A'}`;
                
                // Test rendering
                testRendering();
            };
            script.onerror = () => {
                console.log('❌ KaTeX JS failed from:', jsPath);
                document.getElementById('loading-status').innerHTML = 
                    `<span style="color: #ff6b6b;">❌ Failed to load KaTeX JS from: ${jsPath}</span>`;
            };
            document.head.appendChild(script);
        }
        
        function testRendering() {
            if (typeof katex === 'undefined') {
                console.log('❌ KaTeX not available for rendering');
                return;
            }
            
            try {
                // Test inline math
                const inlineResult = katex.renderToString('E = mc^2', {
                    displayMode: false,
                    throwOnError: false
                });
                document.getElementById('inline-test').innerHTML = inlineResult;
                console.log('✅ Inline math rendered');
                
                // Test display math
                const displayResult = katex.renderToString('\\int_{-\\infty}^{\\infty} e^{-x^2} dx = \\sqrt{\\pi}', {
                    displayMode: true,
                    throwOnError: false
                });
                document.getElementById('display-test').innerHTML = displayResult;
                console.log('✅ Display math rendered');
                
            } catch (error) {
                console.error('❌ Rendering error:', error);
                document.getElementById('loading-status').innerHTML += 
                    `<br><span style="color: #ff6b6b;">Rendering error: ${error.message}</span>`;
            }
        }
        
        // Try loading CSS from different paths
        let pathIndex = 0;
        function tryNextPath() {
            if (pathIndex >= paths.length) {
                document.getElementById('loading-status').innerHTML = 
                    '<span style="color: #ff6b6b;">❌ All paths failed</span>';
                return;
            }
            
            const currentPath = paths[pathIndex];
            console.log('Trying path:', currentPath);
            
            testPath(currentPath, (success) => {
                if (success) {
                    loadKaTeXJS(currentPath);
                } else {
                    pathIndex++;
                    tryNextPath();
                }
            });
        }
        
        tryNextPath();
    </script>
</body>
</html>